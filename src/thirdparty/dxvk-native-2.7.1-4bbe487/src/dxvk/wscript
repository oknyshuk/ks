#! /usr/bin/env python


def options(opt):
    return


def configure(conf):
    conf.define("DXVK_NATIVE", True)
    conf.define("DXVK_WSI_SDL2", True)
    conf.define("DXVK_PLATFORM_LINUX", True)


def build(bld):
    if bld.env.DEST_OS == "win32":
        return

    libs = []

    includes = [
        ".",
        "..",
        "../../include",
        "../../include/native/windows",
        "../../include/vulkan/include",
        "../../include/spirv/include",
        "shaders/generated",
        "hud/shaders/generated",
    ]

    source = [
        "dxvk_access.cpp",
        "dxvk_adapter.cpp",
        "dxvk_allocator.cpp",
        "dxvk_barrier.cpp",
        "dxvk_buffer.cpp",
        "dxvk_cmdlist.cpp",
        "dxvk_compute.cpp",
        "dxvk_constant_state.cpp",
        "dxvk_context.cpp",
        "dxvk_cs.cpp",
        "dxvk_descriptor_heap.cpp",
        "dxvk_descriptor_info.cpp",
        "dxvk_descriptor_pool.cpp",
        "dxvk_descriptor_worker.cpp",
        "dxvk_device.cpp",
        "dxvk_device_filter.cpp",
        "dxvk_device_info.cpp",
        "dxvk_fence.cpp",
        "dxvk_format.cpp",
        "dxvk_framebuffer.cpp",
        "dxvk_gpu_event.cpp",
        "dxvk_gpu_query.cpp",
        "dxvk_graphics.cpp",
        "dxvk_image.cpp",
        "dxvk_implicit_resolve.cpp",
        "dxvk_instance.cpp",
        "dxvk_latency_builtin.cpp",
        "dxvk_latency_reflex.cpp",
        "dxvk_memory.cpp",
        "dxvk_meta_blit.cpp",
        "dxvk_meta_clear.cpp",
        "dxvk_meta_copy.cpp",
        "dxvk_meta_mipgen.cpp",
        "dxvk_meta_resolve.cpp",
        "dxvk_options.cpp",
        "dxvk_pipelayout.cpp",
        "dxvk_pipemanager.cpp",
        "dxvk_platform_exts.cpp",
        "dxvk_presenter.cpp",
        "dxvk_queue.cpp",
        "dxvk_sampler.cpp",
        "dxvk_shader.cpp",
        "dxvk_shader_io.cpp",
        "dxvk_shader_key.cpp",
        "dxvk_shader_spirv.cpp",
        "dxvk_signal.cpp",
        "dxvk_sparse.cpp",
        "dxvk_staging.cpp",
        "dxvk_stats.cpp",
        "dxvk_swapchain_blitter.cpp",
        "dxvk_unbound.cpp",
        "dxvk_util.cpp",
        "hud/dxvk_hud.cpp",
        "hud/dxvk_hud_font.cpp",
        "hud/dxvk_hud_item.cpp",
        "hud/dxvk_hud_renderer.cpp",
    ]

    bld.stlib(
        source=source,
        target="dxvk",
        features="cxx unity",
        unity_size=30,
        includes=includes,
        use=libs,
        cxxflags=["-Wno-nontrivial-memcall"],
        subsystem=bld.env.MSVC_SUBSYSTEM,
        idx=bld.get_taskgen_count(),
    )
